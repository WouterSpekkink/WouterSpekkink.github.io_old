I"^¶<h2 id="interfacing-with-sql-databases-with-qt5">Interfacing with sql databases with Qt5</h2>
<p>This post is on an issue that I struggled with very recently, while working on Q-SoPrA. What I wanted to achieve was relatively simple: I wanted to have tables that fetch data from sql databases, and in which one column shows check boxes to set/unset a boolean variable. The screenshot below shows an example.</p>

<p><br /><br /><a href="/assets/posts/qsqltablemodels-booleans-and-check-boxes/table.png"><img src="/assets/posts/qsqltablemodels-booleans-and-check-boxes/table.png" alt="Table with check boxes" class="center-image" /></a><br /><br /></p>

<p>What you see in the screen shot is <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> widget that shows data that it fetches from a <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> that interfaces with a table of a <a href="https://sqlite.org/">sqlite</a> database. This post is about how to create the interactive check boxes shown in the right-most column. There are two main hurdles in getting the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> widget to work with check boxes:</p>
<ol>
  <li>Sqlite databases donâ€™t actually support boolean variables. You can use an integer variable to â€˜simulateâ€™ a boolean variable by setting it to <code class="language-plaintext highlighter-rouge">0</code>(for <code class="language-plaintext highlighter-rouge">false</code>) or <code class="language-plaintext highlighter-rouge">1</code> (for <code class="language-plaintext highlighter-rouge">true</code>), but you will of course need to do a bit of extra work to make the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> properly treat it as a boolean (or something that can be switched on or off) in read &amp; write operations. This can be done by sub-classing the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a>, and re-implementing its <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#flags">flags()</a>, <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#data">data()</a> and <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#setData">setData()</a> functions, as suggested <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">here</a>.</li>
  <li>But if you do that, youâ€™ll have a quite ugly looking table, since the check boxes are all left-aligned in their column, with no obvious way to change that. In this case, the only solution seems to be to use a <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> to handle the <code class="language-plaintext highlighter-rouge">paint()</code> function that determines how the column is visualised. A somewhat outdated example of how to do that is offered in the <a href="https://wiki.qt.io/Technical_FAQ#How_can_I_align_the_checkboxes_in_a_view.3F">Qt FAQ</a>.</li>
</ol>

<p>For good results in my use-case, where I want to have check boxes that (1) are able to handle a â€˜pretend booleanâ€™ variable (a boolean that is actually an integer) from a sqlite database, and (2) are not all aligned to the extreme left of their column, you have to combine the two solutions mentioned above. I havenâ€™t really encountered a worked out example of this combination, which is why I decided to provide one in this post.</p>

<p>In the below, I briefly outline how you could achieve a result like the one shown in the screenshot above.</p>

<details>
<summary>In case you are not familiar with Qt5...</summary>
<blockquote>
<a href="https://www.qt.io/">Qt5</a> is a popular library for C++ that can be used for the development of Graphical User Interfaces (GUIs). It also includes a module that allows for easy interfacing of your program with sql databases. I make heavy use of the Qt5 library for the development of Q-SoPrA, including the possibilities it offers for interfacing with <a href="https://sqlite.org/">sqlite</a> databases. Qt5 comes packed with a number of great <a href="https://doc.qt.io/qt-5.10/sql-programming.html">sql database classes</a>, such as <a href="https://doc.qt.io/qt-5.10/qsqldatabase.html">QSqlDatabase</a>, <a href="https://doc.qt.io/qt-5.10/qsqlquerymodel.html">QSqlQueryModel</a>, <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a>, <a href="https://doc.qt.io/qt-5.10/qsqlrelationaltablemodel.html">QSqlRelationalTableModel</a>, and <a href="https://doc.qt.io/qt-5.10/qsqlquery.html">QSqlQuery</a>. <br /><br />For the development of Q-SoPrA, I make use of most of all these classes, although often a sub-classed version of them in which I re-implemented some of their member functions. <br /><br />I think a very common setup for interfacing with sql databases is to have a <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> (or <a href="https://doc.qt.io/qt-5.10/qsqlrelationaltablemodel.html">QSqlRelationalTableModel</a>) that fetches data from a table in your sql database, a <a href="https://doc.qt.io/qt-5.10/qsortfilterproxymodel.html">QSortFilterProxyModel</a> that reads from the QSqlTableModel and acts as a 'filtering layer', and a <a href="https://doc.qt.io/qt-5.10/qtableview.html">QTableView</a> that reads from the filter and displays the results on the user's screen. This is also the kind of setup that I use for several widgets that I included in Q-SoPrA, although I typically subclass the QSqlTableModel / QSqlRelationalTableModel to change some of the ways in which the data is presented to the user (such as tool tip behaviour). 
</blockquote>
</details>
<p><br /></p>

<h2 id="an-assumption-about-your-pretend-boolean-variable">An assumption about your â€˜pretend booleanâ€™ variable</h2>
<p>In the below I make one main assumption about your â€˜pretend booleanâ€™ variable, which is that this variable is stored in one of the tables of your sql database as an integer, and that you programmatically set this integer to <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">1</code> whenever necessary. I tend to use the <a href="https://doc.qt.io/qt-5.10/qsqlquery.html">QSqlQuery</a> class for this, but as Doug Forester pointed out in the comment section below, this is a bit inefficient. Instead, it is enough to subclass the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> and re-implement some of its functions as discussed further below.</p>

<p>Before showing how this works, I should add that in the particular use case discussed here, the pretend boolean is stored in a particular column of the sql table that my <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> interfaces with. In the code snippets below you will regularly see a conditional that checks if the current column index is <code class="language-plaintext highlighter-rouge">7</code>, because that is the column that holds the â€˜pretend booleanâ€™ in my specific example. You would of course need to adapt this column index to your own specific use case.</p>

<h2 id="sub-classing-qsqltablemodel">Sub-classing QSqlTableModel</h2>
<p>If we want user interaction with our â€˜pretend booleanâ€™ variable to be handled by a check box, we need to sub-class the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> that interfaces between the sql table and the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> that visualises the data for the user. More specifically, we need to re-implement the <code class="language-plaintext highlighter-rouge">flags()</code>, <code class="language-plaintext highlighter-rouge">data()</code> and <code class="language-plaintext highlighter-rouge">setData()</code> member functions, and make our â€˜pretend booleanâ€™ (an integer set to <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">1</code>) behave as an item that can be checked and unchecked (I believe it was <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">this discussion</a> that led me to this insight). The <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#flags">flags()</a> function basically determines how items recorded in the <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> can be manipulated (see <a href="http://doc.qt.io/qt-5/qt.html#ItemFlag-enum">this list</a> of possible flags). We want to re-implement this function to make sure that items that correspond to our â€˜pretend booleanâ€™ can be checked or unchecked by the user. This can be achieved quite easily:</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
   To make sure that the column with the pretend boolean is recognised
   as a 'checkable' column, we need to re-implement the flags() function
   and create a special case for the target column.
*/</span>
<span class="n">Qt</span><span class="o">::</span><span class="n">ItemFlags</span> <span class="n">EventTableModel</span><span class="o">::</span><span class="n">flags</span><span class="p">(</span><span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="c1">// Column 7 always records the mark variable (our boolean).</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Make sure that this item is checkable.</span>
    <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">flags</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ItemIsUserCheckable</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Default behaviour in all other cases.</span>
  <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">flags</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>As mentioned previously, in the code snippet above we assume that our â€˜pretend booleanâ€™ is recorded in the seventh column of our sql table. We therefore check whether the current index being accessed exists in the seventh column. If yes, then we communicate to the program that the item at this index should be checkable by the user (we also make sure that we return all flags that are set by default). If no, then we revert to the default behaviour of the <code class="language-plaintext highlighter-rouge">QSqlTableModel::flags()</code> member function.</p>

<p>Our sub-classed version of <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> still wonâ€™t understand how to handle our â€˜pretend booleanâ€™ properly. For that, we also need to re-implement the <code class="language-plaintext highlighter-rouge">data()</code> and <code class="language-plaintext highlighter-rouge">setData()</code> functions. The <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#data">data()</a> and <a href="http://doc.qt.io/qt-5/qsqltablemodel.html#setData">setData()</a> are used to read data from, and write data to the sql table with which the QSqlTableModel is interfacing.</p>

<p>We should keep in mind here that in the QSqlTableModel, data are stored under different â€˜rolesâ€™ (see an overview of these roles <a href="http://doc.qt.io/qt-5/qt.html#ItemDataRole-enum">here</a>). For example, data stored under the <code class="language-plaintext highlighter-rouge">Qt::DisplayRole</code> are the data that are actually shown to the user in the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a>, data stored under the <code class="language-plaintext highlighter-rouge">Qt::ToolTipRole</code> are the data that are shown when the user hovers his/her mouse cursor over an entry in the table, and data stored under the <code class="language-plaintext highlighter-rouge">Qt::EditRole</code> are the data that the user can manipulate in an editor. In the <a href="http://doc.qt.io/qt-5/qt.html#ItemDataRole-enum">list of roles</a> you will also find the <code class="language-plaintext highlighter-rouge">Qt::CheckStateRole</code>, and this is the role that we want to (re-)implement for our â€˜pretend booleanâ€™.</p>

<p>Another thing we should keep in mind is that we donâ€™t want <em>all</em> data in our sql table to be treated as â€˜pretend booleans.â€™ We will want to keep the default behaviour of the <code class="language-plaintext highlighter-rouge">data()</code> and <code class="language-plaintext highlighter-rouge">setData()</code> functions in most cases. We can do that in the same way by as we did with the <code class="language-plaintext highlighter-rouge">flags()</code> function: We create a special case for the column that holds our <code class="language-plaintext highlighter-rouge">pretend boolean</code> variable, and we revert to the default implementation of <code class="language-plaintext highlighter-rouge">QSqlTableModel::data()</code> and <code class="language-plaintext highlighter-rouge">QSqlTableModel::SetData()</code> in all other cases.</p>

<blockquote>Actually, in the example below we have one other exception, which is the special case in which the user is hovering the mouse cursor over a cell, which will cause the QSqlTableModel to return data under the Qt::ToolTipRole.</blockquote>

<p>Letâ€™s start with our <code class="language-plaintext highlighter-rouge">data()</code> function. See a snippet with its re-implemented version below. <strong>EDIT: The updated version below implements a suggestion made by Doug Forester in the comments. It is more efficient than what I originally came up with.</strong></p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">QVariant</span> <span class="n">EventTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">,</span> <span class="kt">int</span> <span class="n">role</span><span class="p">)</span> <span class="k">const</span> 
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> 
    <span class="p">{</span> <span class="c1">// This is always the column with the boolean variable</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">)</span> 
	<span class="p">{</span> <span class="c1">// Only do the below when we are setting the checkbox.</span>
	  <span class="c1">// We can simply fetch the value from the current index</span>
	  <span class="kt">int</span> <span class="n">checked</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">).</span><span class="n">toInt</span><span class="p">();</span>
	  <span class="c1">// If checked == 1, then it evaluates to true in the if-statement below.</span>
	  <span class="c1">// If checked == 0, the statement evaluates to false.</span>
	  <span class="k">if</span> <span class="p">(</span><span class="n">checked</span><span class="p">)</span>
	    <span class="p">{</span>
	      <span class="k">return</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span><span class="p">;</span>
	    <span class="p">}</span>
	  <span class="k">else</span>
	    <span class="p">{</span>
	      <span class="k">return</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Unchecked</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
      <span class="k">else</span> 
	<span class="p">{</span>
	  <span class="cm">/*
	    We return an empty variant in all other cases. This is to prevent, for example,
	    that we also see a '0' or '1' in the same column.
	  */</span>
	  <span class="k">return</span> <span class="n">QVariant</span><span class="p">();</span>
	<span class="p">}</span>
      <span class="c1">// Only do the below if we want to fetch a tool tip.</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ToolTipRole</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="c1">// I just want the tool tip to show the data in the column.</span>
      <span class="k">const</span> <span class="n">QString</span> <span class="n">original</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DisplayRole</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
      <span class="n">QString</span> <span class="n">toolTip</span> <span class="o">=</span> <span class="n">breakString</span><span class="p">(</span><span class="n">original</span><span class="p">);</span> <span class="c1">// breakString() breaks the text in smaller lines.</span>
      <span class="k">return</span> <span class="n">toolTip</span><span class="p">;</span>
      <span class="c1">// I want to make sure that broken lines have a space between them.</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DisplayRole</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="k">const</span> <span class="n">QString</span> <span class="n">original</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DisplayRole</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
      <span class="n">QString</span> <span class="n">shownText</span> <span class="o">=</span> <span class="n">fixBreakLines</span><span class="p">(</span><span class="n">original</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">shownText</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">else</span> 
    <span class="p">{</span>
      <span class="cm">/* 
	 In all other cases, we want the default behaviour of this function. 
	 This can be done easily by returning the default version of the function,
	 rather than the re-implemented version we have here.
      */</span>
      <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">role</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">QVariant</span><span class="p">();</span> <span class="c1">// This prevents a compiler warning.</span>
<span class="p">}</span></code></pre></figure>

<p>So, the basic structure of this function is quite simple. We first check if the column of the sql table that is being accessed is the column with our <code class="language-plaintext highlighter-rouge">pretend boolean</code>. If yes, then we check whether the data are being accessed under the â€˜Qt::CheckStateRoleâ€™. If the answer is yes again, we can fetch the current value of our â€˜pretend booleanâ€™ by accessing the data stored in the current index, and we store this value in <code class="language-plaintext highlighter-rouge">int checked</code>. The function will return <code class="language-plaintext highlighter-rouge">Qt::Checked</code> if <code class="language-plaintext highlighter-rouge">checked == 1</code>, and it will return <code class="language-plaintext highlighter-rouge">0</code> if <code class="language-plaintext highlighter-rouge">checked==0</code>.</p>

<p>There are a few other situations that the re-implemented function handles. If we are accessing data in the column with our <code class="language-plaintext highlighter-rouge">pretend boolean</code>, but we are not accessing the data under the <code class="language-plaintext highlighter-rouge">Qt::CheckState</code> role, then the function simply returns an empty QVariant(), effectively returning nothing. I did this to make sure that the corresponding column in the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> only shows a check box that visualises the current check state, and nothing else. If we are accessing data in any other column, the function first checks whether we are accessing data under the <code class="language-plaintext highlighter-rouge">Qt::ToolTipRole</code>. If yes, then we treat it as another special case, in which the user gets shown a tool tip that simply contains the visible contents of the cell currently being hovered over with the mouse cursor. If we are not accessing the data under the <code class="language-plaintext highlighter-rouge">Qt::ToolTipRole</code> (in all other cases), we just revert to the default implementation of the <code class="language-plaintext highlighter-rouge">QSqlTableModel::data()</code> function.</p>

<p>If you have re-implemented the <code class="language-plaintext highlighter-rouge">data()</code> function in this way, then your <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> should already show check boxes in the corresponding column. So far, so good. However, there are still a few problems. One problem is that the check boxes are aligned to the extreme left of the column, which makes the table look ugly. We will deal with this later. A more urgent problem is that checking / unchecking the check boxes wonâ€™t actually do anything meaningful with the underlying data, unless we also re-implement the <code class="language-plaintext highlighter-rouge">setData()</code> function. Letâ€™s do that next.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="kt">bool</span> <span class="n">EventTableModel</span><span class="o">::</span><span class="n">setData</span><span class="p">(</span><span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span> <span class="n">index</span><span class="p">,</span>
			      <span class="k">const</span> <span class="n">QVariant</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">role</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="cm">/* 
     Let's check whether the selected column is the column with our boolean variable
     (always column 7), and whether we are trying to set data under the 
     Qt::CheckStateRole.
  */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span> <span class="o">&amp;&amp;</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="c1">// Writing the data when the check box is set to checked.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span><span class="p">)</span> 
	<span class="p">{</span>
	  <span class="c1">// Let's write the new value</span>
	  <span class="k">return</span> <span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	  <span class="c1">// Writing the data when the check box is set to unchecked</span>
	<span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Unchecked</span><span class="p">)</span> 
	<span class="p">{</span>
	  <span class="c1">// Let's write the new value</span>
	  <span class="k">return</span> <span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>
  <span class="c1">// In all other situations revert to default behaviour.</span>
  <span class="k">return</span> <span class="n">QSqlTableModel</span><span class="o">::</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>We have a similar kind of check to the one we had with the <code class="language-plaintext highlighter-rouge">data()</code> function: We check whether thes column we are writing to is the column that contains our <code class="language-plaintext highlighter-rouge">pretend boolean</code> variable. In this case, we check at the same time whether we are trying to write data under the <code class="language-plaintext highlighter-rouge">Qt::CheckStateRole</code>. If yes, we write either a <code class="language-plaintext highlighter-rouge">1</code> or a <code class="language-plaintext highlighter-rouge">0</code> to the corresponding index, depending on what value was passed to the function. In all other situations we simply refer to the default implementation of the <code class="language-plaintext highlighter-rouge">QSqlTableModel::setData()</code> function.</p>

<p>After re-implementing the <code class="language-plaintext highlighter-rouge">data()</code> function this way, checking / unchecking the check boxes in our <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> will actually do something meaningful with the data in the underlying sql table.</p>

<p>If you donâ€™t care about the alignment of the check boxes in their corresponding column of the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a>, then youâ€™re done. However, I think that the table looks much nicer with the check boxes aligned to the centre of their column. How to achieve this is what I will discuss next.</p>

<h2 id="styling-the-column-with-the-check-boxes">Styling the column with the check boxes</h2>
<p>It turns out that the only way to align the check boxes to the centre of their column is to use a <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a>. Well, there is <a href="https://falsinsoft.blogspot.co.uk/2013/11/qtablewidget-center-checkbox-inside-cell.html">another approach that uses layouts</a>, but that only works if you (1) manually append another column to your <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a>, (2) explicitly create <code class="language-plaintext highlighter-rouge">QCheckBox</code> objects, (3) assign these to a parent <code class="language-plaintext highlighter-rouge">QWidget</code> object, (4) to which you then apply a centralised layout. This is quite an expensive procedure that can significantly reduce the performance of your program, and it only works well if you donâ€™t update your <a href="https://doc.qt.io/qt-5.10/qsqltablemodel.html">QSqlTableModel</a> frequently.</p>

<blockquote>
This is because every time that you update your QSqlTableModel the manually appended column will disappear. You can of course solve this by writing a function that creates the extra column, and fills it with your manually created check boxes, and run this function whenever the QSqlTableModel's select() function gets called. However, this will slow down your program quite a bit, and I also found some other drawbacks to this approach that are a bit outside the scope of this discussion.
</blockquote>

<p>The approach that uses a <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> is actually what is recommended in <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">Qtâ€™s FAQ</a> section. An example code snippet is offered there as well, although it is a bit outdated (it uses some functions that were deprecated in Qt5). Essentially, what you are required to do is to create your own sub-class of <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a>, and re-implement its <code class="language-plaintext highlighter-rouge">paint()</code> and <code class="language-plaintext highlighter-rouge">editorEvent()</code> functions. The <code class="language-plaintext highlighter-rouge">paint()</code> function determines how the check box is visualised to the user, and the <code class="language-plaintext highlighter-rouge">editorEvent()</code> function determines how the user can interact with the check box.</p>

<p>I included the snippet with my slightly adapted version of the re-implemented functions below. I am not going to pretend that I grasp every detail of what happens in these functions. I mostly replaced some of the deprecated functions in the example offered in <a href="http://www.qtcentre.org/threads/12008-QSqlTableModel-and-checkboxes-with-SQLite-database">Qtâ€™s FAQ</a>.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
   This is a slightly adapted version of the example that is provided here:
   https://wiki.qt.io/Technical_FAQ#How_can_I_align_the_checkboxes_in_a_view.3F
*/</span>

<span class="kt">void</span> <span class="n">CheckBoxDelegate</span><span class="o">::</span><span class="n">paint</span> <span class="p">(</span><span class="n">QPainter</span> <span class="o">*</span> <span class="n">painter</span><span class="p">,</span> <span class="k">const</span> <span class="n">QStyleOptionViewItem</span> <span class="o">&amp;</span> <span class="n">option</span><span class="p">,</span>
	    <span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">QStyleOptionViewItem</span> <span class="n">viewItemOption</span><span class="p">(</span><span class="n">option</span><span class="p">);</span>
  <span class="c1">// Only do this if we are accessing the column with boolean variables.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This basically changes the rectangle in which the check box is drawn.</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">textMargin</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">::</span><span class="n">style</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pixelMetric</span><span class="p">(</span><span class="n">QStyle</span><span class="o">::</span><span class="n">PM_FocusFrameHMargin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">QRect</span> <span class="n">newRect</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">::</span><span class="n">alignedRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignCenter</span><span class="p">,</span>
					<span class="n">QSize</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">decorationSize</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">+</span>
					      <span class="mi">5</span><span class="p">,</span><span class="n">option</span><span class="p">.</span><span class="n">decorationSize</span><span class="p">.</span><span class="n">height</span><span class="p">()),</span>
					<span class="n">QRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">textMargin</span><span class="p">,</span> <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span>
					      <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span>
					      <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">textMargin</span><span class="p">),</span> <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()));</span>
    <span class="n">viewItemOption</span><span class="p">.</span><span class="n">rect</span> <span class="o">=</span> <span class="n">newRect</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Draw the check box using the new rectangle.</span>
  <span class="n">QStyledItemDelegate</span><span class="o">::</span><span class="n">paint</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">viewItemOption</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">CheckBoxDelegate</span><span class="o">::</span><span class="n">editorEvent</span><span class="p">(</span><span class="n">QEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">,</span> <span class="n">QAbstractItemModel</span> <span class="o">*</span><span class="n">model</span><span class="p">,</span>
			 <span class="k">const</span> <span class="n">QStyleOptionViewItem</span> <span class="o">&amp;</span><span class="n">option</span><span class="p">,</span>
			 <span class="k">const</span> <span class="n">QModelIndex</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Q_ASSERT</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
  <span class="n">Q_ASSERT</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>

  <span class="c1">// make sure that the item is checkable</span>
  <span class="n">Qt</span><span class="o">::</span><span class="n">ItemFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">model</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ItemIsUserCheckable</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">::</span><span class="n">ItemIsEnabled</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// make sure that we have a check state</span>
  <span class="n">QVariant</span> <span class="n">value</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="n">isValid</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// make sure that we have the right event type</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">::</span><span class="n">MouseButtonRelease</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">textMargin</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">::</span><span class="n">style</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pixelMetric</span><span class="p">(</span><span class="n">QStyle</span><span class="o">::</span><span class="n">PM_FocusFrameHMargin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">QRect</span> <span class="n">checkRect</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">::</span><span class="n">alignedRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignCenter</span><span class="p">,</span>
					  <span class="n">option</span><span class="p">.</span><span class="n">decorationSize</span><span class="p">,</span>
					  <span class="n">QRect</span><span class="p">(</span><span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">textMargin</span><span class="p">),</span> <span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span>
						<span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">textMargin</span><span class="p">),</span>
						<span class="n">option</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()));</span>
    <span class="c1">// We handle the mouse event...</span>
    <span class="n">QMouseEvent</span> <span class="o">*</span><span class="n">mEvent</span> <span class="o">=</span> <span class="p">(</span><span class="n">QMouseEvent</span><span class="o">*</span><span class="p">)</span> <span class="n">event</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">checkRect</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mEvent</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// as well as the key press event.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">::</span><span class="n">KeyPress</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">QKeyEvent</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">()</span> <span class="o">!=</span>
	<span class="n">Qt</span><span class="o">::</span><span class="n">Key_Space</span><span class="o">&amp;&amp;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">QKeyEvent</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Key_Select</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Determine the new check state</span>
  <span class="n">Qt</span><span class="o">::</span><span class="n">CheckState</span> <span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Qt</span><span class="o">::</span><span class="n">CheckState</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span>
			  <span class="o">?</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Unchecked</span> <span class="o">:</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Checked</span><span class="p">);</span>
  <span class="c1">// And set the new check state by calling the model's setData() function.</span>
  <span class="k">return</span> <span class="n">model</span><span class="o">-&gt;</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">CheckStateRole</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>The re-implemented version of the <code class="language-plaintext highlighter-rouge">paint()</code> function basically just changes the position at which the check box is drawn, by changing the rectangle within which the paint event takes place, and then calling the default version of the <code class="language-plaintext highlighter-rouge">paint()</code> function with an option parameter that includes the altered rectangle.</p>

<p>The re-implemented version of the <code class="language-plaintext highlighter-rouge">editorEvent()</code> function handles various events through which the user might manipulate the current state of the check box. If an event meets the required conditions (e.g., a <code class="language-plaintext highlighter-rouge">QEvent::MouseButtonRelease</code> took place within the rectangle where the check box is drawn), then we call the <code class="language-plaintext highlighter-rouge">setData()</code> function (the one we re-implemented earlier) with the appropriate parameters.</p>

<p>There is actually one other thing we need to do if we want our <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> to work. We need to tell our <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> object to use the delegate in its seventh column. In my case, the <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> object is named <code class="language-plaintext highlighter-rouge">tableView</code>, and the sub-classed version of the <a href="http://doc.qt.io/qt-5/qstyleditemdelegate.html">QStyledItemDelegate</a> I created is named <code class="language-plaintext highlighter-rouge">CheckBoxDelegate</code>. I set <code class="language-plaintext highlighter-rouge">tableView</code> to use the <code class="language-plaintext highlighter-rouge">CheckBoxDelegate</code> by using the following function:</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">tableView</span><span class="o">-&gt;</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="k">new</span> <span class="nf">CheckBoxDelegate</span><span class="p">(</span><span class="n">tableView</span><span class="p">));</span></code></pre></figure>

<p>And that should do the trick! Now you should have a <a href="http://doc.qt.io/archives/qt-4.8/qtableview.html">QTableView</a> with a nice-looking column of check boxes through which the user can interact with â€˜pretend booleanâ€™ variables in your sql database.</p>

:ET